Name: ADUM.vbs – Active Directory User Management

Synopsis: A script that will look for user objects in and Active Directory (AD) environment and based how long since the last logon, disable the account if other conditions have been met correctly.

Description: This script is partially a wrapper to a 3rd party application that uses output generated by this program as later input for the rest of the code. We purchased TrueLastLogon (TLL) from Dovestone Software due to its ability to dynamically scan all Domain Controllers (DCs) in a given domain and collect the most up to date logon information on all user objects. This process is tricky as the three (3) fields that we make decisions on are not replicated across all DCs, and making decisions on one site’s AD information has a high likelihood of inaccuracy. 

TLL generates an output file, which we save as adum.report.DDMonYYYY.csv based on the following criteria:
o	Object class == user
o	Account last logon information > cDaysExpire variable (currently 60)
o	Account was not created in the last cDaysIgnore (currently 7)
o	Account belongs in the ADName domain (domain name is based on the computer running the program)

Once the TLL program completes, we read through an exception file, named adum.exception.lst, and load these entries into an array for later searching for accounts that need to be skipped. We open the TLL output file as input to the rest of the script and loop through every line performing the following fuzzy logic:

Read User from adum.report.DDMonYYYY.csv
Load User into class array
If User is Enabled Then
	Search Exceptions array For User
Did we find match in the Exceptions array
			Write that we would disable, but matched account
		We Did NOT find a match
Are we supposed to disable accounts?
				Disable the user & write log information
	Read Next Record

Once the script has looped through all the lines in the adum.report.DDMonYYYY.csv file it generates an email with information about the run, number of records processed, number of accounts that were skipped due to exceptions, number of users already disabled and attaching two (2) files to the email. The debug log file named adum.debug.log and the file that lists the accounts that were disabled on this run named adum.actions.DDMonYYYY.csv. When disabling the account, the account is not moved thus staying in the OU that it originally resided in. We add a comment in the .Description field of the user object that will help for filtering and auditing. The comment will read “!Disabled: DDMonYYYY HH:MM”. (If you are re-enabling an account that has been disabled by this application, please remove this comment.)
